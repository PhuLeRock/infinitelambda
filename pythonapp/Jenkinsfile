pipeline {
    agent any
    environment {
        AWS_DEFAULT_REGION = "ap-southeast-1"
        AWS_DEFAULT_OUTPUT = "text"
        ECRRepoName = "667656621301.dkr.ecr.ap-southeast-1.amazonaws.com/pyapp"
        ECRCredID = 'phule'
        GitRepo = 'https://github.com/PhuLeRock/infinitelambda.git'
        GitCreID = 'phulegit'
    }

    stages {
        stage("git checkout") {
            steps {
                git credentialsId: '${GitCreID}', url: '${GitRepo}'
            }
        }           
    
        stage('push test') {
            steps {
                script {
                    docker.withRegistry(https://${ECRRepoName}, ecr:ap-southeast-1:${ECRCredID}) {
                    docker.image('${ECRRepoName}').push(1.0) 
                    }
                }
            }                    
        }
            
    }
}            